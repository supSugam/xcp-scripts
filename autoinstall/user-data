#cloud-config
autoinstall:
  version: 1
  identity:
    realname: 'Root User'
    hostname: 'ubuntu'
    username: 'root'
  ssh:
    install-server: true
    authorized-keys:
      - ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIGGKEX+09+ySyju3eMvZmDe8fZqkJB76x+DSYqZMh5N8 ctrlcat@LitterBox
    allow-pw: false
  keyboard:
    layout: us
  locale: en_US
  network:
    network:
      version: 2
      ethernets:
        enp1s0:
          dhcp4: true
  storage:
    layout:
      name: lvm
  updates: security
  package_selection: standard
  packages:
    - vim
    - curl
    - wget
    - git
    - openssh-server
    - python3
    - python3-pip
  late-commands:
    - echo "Setting up root user..."
    - mkdir -p /root/.ssh
    - echo "ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIGGKEX+09+ySyju3eMvZmDe8fZqkJB76x+DSYqZMh5N8 ctrlcat@LitterBox" > /root/.ssh/authorized_keys
    - chmod 600 /root/.ssh/authorized_keys
    - chown -R root:root /root/.ssh
    - sed -i 's/^#\?PermitRootLogin.*/PermitRootLogin prohibit-password/' /etc/ssh/sshd_config
    - sed -i 's/^#\?PasswordAuthentication.*/PasswordAuthentication no/' /etc/ssh/sshd_config
    - systemctl restart ssh
